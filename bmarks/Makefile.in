iRCCEINCLUDE := ../include

include $(SYMBOLSPATH)

CFLAGS := $(CFLAGS) -I$(iRCCEINCLUDE)
CFLAGSP := $(CFLAGS) -I$(iRCCEINCLUDE) -pthread
TMH := $(iRCCEINCLUDE)/../src/pubSubTM.c $(iRCCEINCLUDE)/../src/rwhash.c $(iRCCEINCLUDE)/../src/log.c $(iRCCEINCLUDE)/pubSubTM.h \
	$(iRCCEINCLUDE)/common.h $(iRCCEINCLUDE)/tm.h $(iRCCEINCLUDE)/stm.h \
	$(iRCCEINCLUDE)/hashtable.h $(iRCCEINCLUDE)/rwhash.h $(iRCCEINCLUDE)/log.h

MB_LL := microbench/linkedlist

BANKOBJS  := bank.o   $(ARCHIVE)
MTESTOBJS  := mtest.o   $(ARCHIVE)
MBLLOBJS := $(MB_LL)/linkedlist.o $(MB_LL)/test.o $(ARCHIVE)

.PHONY: all default clean bank

default:
	@echo "Usage: make bank"
	@echo "       make mbll "
	@echo "       make all "

all: bank

bank: $(BANKOBJS)
	$(CCOMPILE) -o bank $(BANKOBJS) $(CFLAGS)

bank.o: bank.c $(RCCEINCLUDE)/RCCE.h $(iRCCEINCLUDE)/iRCCE.h $(TMH)
	$(CCOMPILE) -c $(CFLAGS) bank.c

mtest: $(MTESTOBJS)
	$(CCOMPILE) -o mtest $(MTESTOBJS) $(CFLAGS)

mtest.o: mtest.c $(RCCEINCLUDE)/RCCE.h $(iRCCEINCLUDE)/iRCCE.h $(TMH)
	$(CCOMPILE) -c $(CFLAGS) mtest.c

$(MB_LL)/linkedlist.o: 
	$(CCOMPILE) -c $(CFLAGS) -o $(MB_LL)/linkedlist.o $(MB_LL)/linkedlist.c

$(MB_LL)/intset.o: $(MB_LL)/linkedlist.h $(MB_LL)/harris.h
	$(CCOMPILE) -c $(CFLAGS) -o $(MB_LL)/intset.o $(MB_LL)/intset.c

$(MB_LL)/test.o: $(MB_LL)/linkedlist.h $(MB_LL)/harris.h $(MB_LL)/intset.h
	$(CCOMPILE) -c $(CFLAGS) -o $(MB_LL)/test.o $(MB_LL)/test.c

mbll:  $(MBLLOBJS) $(TMH)
	$(CCOMPILE) -o mbll $(CFLAGS) $(MBLLOBJS)


clean:
	@ rm -f *.o $(MB_LL)/*.o bank mbll



