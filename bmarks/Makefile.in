iRCCEINCLUDE := ../include

include $(SYMBOLSPATH)

CFLAGS := $(CFLAGS) -I$(iRCCEINCLUDE)
CFLAGSP := $(CFLAGS) -I$(iRCCEINCLUDE) -pthread
TMH := $(iRCCEINCLUDE)/../src/pubSubTM.c $(iRCCEINCLUDE)/../src/rwhash.c $(iRCCEINCLUDE)/../src/log.c $(iRCCEINCLUDE)/pubSubTM.h \
	$(iRCCEINCLUDE)/common.h $(iRCCEINCLUDE)/tm.h $(iRCCEINCLUDE)/stm.h \
	$(iRCCEINCLUDE)/hashtable.h $(iRCCEINCLUDE)/rwhash.h $(iRCCEINCLUDE)/log.h

MB_LL := microbench/linkedlist
MB_LLPGAS := microbench/linkedlistpgas
MB_HT := microbench/hashtable
MB_HTPGAS := microbench/hashtablepgas
MR := mapreduce

BANKOBJS  := bank.o   $(ARCHIVE)
BANKPGASOBJS  := bankpgas.o   $(ARCHIVE)
BANKSOBJS  := bankseq.o   $(ARCHIVE)
MTESTOBJS  := mtest.o   $(ARCHIVE)
MROBJS := $(MR)/mr.o $(ARCHIVE)	
MBLLOBJS := $(MB_LL)/linkedlist.o $(MB_LL)/test.o $(ARCHIVE)
MBLLPGASOBJS := $(MB_LLPGAS)/linkedlist.o $(MB_LLPGAS)/test.o $(ARCHIVE)
MBHTOBJS := $(MB_LL)/linkedlist.o $(MB_HT)/test.o $(MB_HT)/intset.o $(MB_HT)/hashtable.o $(ARCHIVE)
MBHTPGASOBJS := $(MB_LLPGAS)/linkedlist.o $(MB_HTPGAS)/test.o $(MB_HTPGAS)/intset.o $(MB_HTPGAS)/hashtable.o $(ARCHIVE)
ROOBJS  := readonly.o   $(ARCHIVE)

.PHONY: all default clean bank

default:
	@echo "Usage: make bank"
	@echo "       make mbll "
	@echo "       make mbht "
	@echo "       make ro "
	@echo "       make mr "
	@echo "       make all "

all: bank mbll mbht ro

bank: $(BANKOBJS)
	$(CCOMPILE) -o bank $(BANKOBJS) $(CFLAGS)

bankpgas: $(BANKPGASOBJS)
	$(CCOMPILE) -o bankpgas $(BANKPGASOBJS) $(CFLAGS)

bankseq: $(BANKSOBJS)
	$(CCOMPILE) -o bankseq $(BANKSOBJS) $(CFLAGS)

bank.o: bank.c $(RCCEINCLUDE)/RCCE.h $(iRCCEINCLUDE)/iRCCE.h $(TMH)
	$(CCOMPILE) -c $(CFLAGS) bank.c

bankpgas.o: bankpgas.c $(RCCEINCLUDE)/RCCE.h $(iRCCEINCLUDE)/iRCCE.h $(TMH)
	$(CCOMPILE) -c $(CFLAGS) bankpgas.c

bankseq.o: bankseq.c $(RCCEINCLUDE)/RCCE.h $(iRCCEINCLUDE)/iRCCE.h $(TMH)
	$(CCOMPILE) -c $(CFLAGS) bankseq.c

mtest: $(MTESTOBJS)
	$(CCOMPILE) -o mtest $(MTESTOBJS) $(CFLAGS)

mtest.o: mtest.c $(RCCEINCLUDE)/RCCE.h $(iRCCEINCLUDE)/iRCCE.h $(TMH)
	$(CCOMPILE) -c $(CFLAGS) mtest.c

$(MR)/mr.o: $(MR)/mr.c $(TMH)
	$(CCOMPILE) -c $(CFLAGS) -o $(MR)/mr.o $(MR)/mr.c

$(MB_LL)/linkedlist.o: $(MB_LL)/test.c $(MB_LL)/linkedlist.h $(MB_LL)/linkedlist.c $(MB_LL)/harris.h
	$(CCOMPILE) -c $(CFLAGS) -o $(MB_LL)/linkedlist.o $(MB_LL)/linkedlist.c

$(MB_LL)/test.o: $(MB_LL)/test.c $(MB_LL)/linkedlist.h $(MB_LL)/linkedlist.c $(MB_LL)/harris.h
	$(CCOMPILE) -c $(CFLAGS) -o $(MB_LL)/test.o $(MB_LL)/test.c

$(MB_LLPGAS)/linkedlist.o: $(MB_LLPGAS)/test.c $(MB_LLPGAS)/linkedlist.h $(MB_LLPGAS)/linkedlist.c $(MB_LLPGAS)/harris.h
	$(CCOMPILE) -c $(CFLAGS) -o $(MB_LLPGAS)/linkedlist.o $(MB_LLPGAS)/linkedlist.c

$(MB_LLPGAS)/test.o: $(MB_LLPGAS)/test.c $(MB_LLPGAS)/linkedlist.h $(MB_LLPGAS)/linkedlist.c $(MB_LLPGAS)/harris.h
	$(CCOMPILE) -c $(CFLAGS) -o $(MB_LLPGAS)/test.o $(MB_LLPGAS)/test.c

mr:  $(MROBJS) $(TMH)
	$(CCOMPILE) -o mr $(CFLAGS) $(MROBJS)

mbll:  $(MBLLOBJS) $(TMH)
	$(CCOMPILE) -o mbll $(CFLAGS) $(MBLLOBJS)

mbllpgas:  $(MBLLPGASOBJS) $(TMH)
	$(CCOMPILE) -o mbllpgas $(CFLAGS) $(MBLLPGASOBJS)

$(MB_HT)/hashtable.o: $(MB_LL)/linkedlist.o $(MB_HT)/hashtable.c $(MB_HT)/hashtable.h $(MB_LL)/linkedlist.c \
	$(MB_LL)/harris.h $(MB_LL)/linkedlist.h
	$(CCOMPILE) -c $(CFLAGS) -o $(MB_HT)/hashtable.o $(MB_HT)/hashtable.c

$(MB_HT)/intset.o: $(MB_LL)/linkedlist.o $(MB_HT)/intset.c $(MB_HT)/hashtable.h $(MB_LL)/linkedlist.c $(MB_LL)/harris.h $(MB_LL)/linkedlist.h
	$(CCOMPILE) -c $(CFLAGS) -o $(MB_HT)/intset.o $(MB_HT)/intset.c

$(MB_HT)/test.o: $(MB_LL)/linkedlist.o $(MB_HT)/test.c $(MB_LL)/linkedlist.h $(MB_HT)/intset.c $(MB_HT)/hashtable.c
	$(CCOMPILE) -c $(CFLAGS) -o $(MB_HT)/test.o $(MB_HT)/test.c

mbht:  $(MBHTOBJS) $(TMH)
	$(CCOMPILE) -o mbht $(CFLAGS) $(MBHTOBJS)

$(MB_HTPGAS)/hashtable.o: $(MB_LLPGAS)/linkedlist.o $(MB_HTPGAS)/hashtable.c $(MB_HTPGAS)/hashtable.h $(MB_LLPGAS)/linkedlist.c \
	$(MB_LLPGAS)/harris.h $(MB_LLPGAS)/linkedlist.h
	$(CCOMPILE) -c $(CFLAGS) -o $(MB_HTPGAS)/hashtable.o $(MB_HTPGAS)/hashtable.c

$(MB_HTPGAS)/intset.o: $(MB_LLPGAS)/linkedlist.o $(MB_HTPGAS)/intset.c $(MB_HTPGAS)/hashtable.h $(MB_LLPGAS)/linkedlist.c \
	$(MB_LLPGAS)/harris.h $(MB_LLPGAS)/linkedlist.h
	$(CCOMPILE) -c $(CFLAGS) -o $(MB_HTPGAS)/intset.o $(MB_HTPGAS)/intset.c

$(MB_HTPGAS)/test.o: $(MB_LLPGAS)/linkedlist.o $(MB_HTPGAS)/test.c $(MB_LLPGAS)/linkedlist.h $(MB_HTPGAS)/intset.c $(MB_HTPGAS)/hashtable.c
	$(CCOMPILE) -c $(CFLAGS) -o $(MB_HTPGAS)/test.o $(MB_HTPGAS)/test.c

mbhtpgas:  $(MBHTPGASOBJS) $(TMH)
	$(CCOMPILE) -o mbhtpgas $(CFLAGS) $(MBHTPGASOBJS)


ro: $(ROOBJS)
	$(CCOMPILE) -o ro $(ROOBJS) $(CFLAGS)

readonly.o: readonly.c $(RCCEINCLUDE)/RCCE.h $(iRCCEINCLUDE)/iRCCE.h $(TMH)
	$(CCOMPILE) -c $(CFLAGS) readonly.c

clean:
	@ rm -f *.o $(MB_LL)/*.o bank mbll $(MB_HT)/*.o mbht ro



